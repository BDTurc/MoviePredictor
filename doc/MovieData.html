<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class MovieData - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-analyze_data">#analyze_data</a>
    
    <li ><a href="#method-i-best_match">#best_match</a>
    
    <li ><a href="#method-i-load_data">#load_data</a>
    
    <li ><a href="#method-i-most_similar">#most_similar</a>
    
    <li ><a href="#method-i-movielist">#movielist</a>
    
    <li ><a href="#method-i-movies_average_modification">#movies_average_modification</a>
    
    <li ><a href="#method-i-predict">#predict</a>
    
    <li ><a href="#method-i-prediction_data">#prediction_data</a>
    
    <li ><a href="#method-i-prediction_modifiers">#prediction_modifiers</a>
    
    <li ><a href="#method-i-rating">#rating</a>
    
    <li ><a href="#method-i-rating_average">#rating_average</a>
    
    <li ><a href="#method-i-run_test">#run_test</a>
    
    <li ><a href="#method-i-users_pattern_rating">#users_pattern_rating</a>
    
    <li ><a href="#method-i-viewers">#viewers</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-MovieData">
  <h1 id="class-MovieData" class="class">
    class MovieData
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(folder, string = 'u.data')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">folder</span>, <span class="ruby-identifier">string</span> = <span class="ruby-string">&#39;u.data&#39;</span>) 
  <span class="ruby-ivar">@user_hash</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#Hash with all users as keys to an array containing</span>
                        <span class="ruby-comment">#the movies they&#39;ve seen and the ratings they gave.</span>
  <span class="ruby-ivar">@movie_hash</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#Hash with all movies as keys to an array containing</span>
                         <span class="ruby-comment"># all users who viewed it and their ratings.</span>
  <span class="ruby-ivar">@best_match</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#Generated by most_similar</span>
  <span class="ruby-ivar">@user_marker</span> = <span class="ruby-string">&#39;0&#39;</span> <span class="ruby-comment">#Used by predict to determine if our current &quot;best match&quot;</span>
                     <span class="ruby-comment">#array can be used for this user as well&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;u.data&#39;</span>
    <span class="ruby-ivar">@trainingfile</span> = <span class="ruby-string">&#39;u.data&#39;</span>
  <span class="ruby-keyword">else</span>
  <span class="ruby-ivar">@trainingfile</span> = <span class="ruby-node">&quot;#{folder}/#{string}.base&quot;</span>
  <span class="ruby-ivar">@testfile</span> = <span class="ruby-node">&quot;#{folder}/#{string}.test&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-analyze_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">analyze_data</span><span
            class="method-args">(results_array)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generates an object of <a href="MovieTest.html">MovieTest</a> class and
runs its methods to analyze our data.</p>
          
          

          
          <div class="method-source-code" id="analyze_data-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">analyze_data</span>(<span class="ruby-identifier">results_array</span>)
  <span class="ruby-identifier">my_results</span> = <span class="ruby-constant">MovieTest</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">results_array</span>) <span class="ruby-comment">#create object of the MovieTest class to analyze data.</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Mean error = #{my_results.mean_error}&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Stddev = #{my_results.stddev}&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;rms error = #{my_results.rms_error}&quot;</span>
  <span class="ruby-identifier">my_results</span>.<span class="ruby-identifier">to_array</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-best_match" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">best_match</span><span
            class="method-args">(reviewer_similarity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>sets <a href="MovieData.html#method-i-best_match">#best_match</a> to be
only the top 20 users. Interestingly, changing this to be even the top 100,
and changing the best match to take anyone with just similar ratings (not
exact matches) does not greatly change our results.</p>
          
          

          
          <div class="method-source-code" id="best_match-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">best_match</span>(<span class="ruby-identifier">reviewer_similarity</span>)
  <span class="ruby-identifier">sorted_list</span> = <span class="ruby-identifier">reviewer_similarity</span>.<span class="ruby-identifier">sort_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-operator">-</span><span class="ruby-identifier">v</span>}
  <span class="ruby-identifier">sorted_list</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">20</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@best_match</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads data into two groups:  A hash of arrays containing movie-rating pairs
and a hash of arrays containing user-rating pairs</p>
          
          

          
          <div class="method-source-code" id="load_data-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_data</span>() 
  <span class="ruby-identifier">target_data</span> = <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@trainingfile</span>, <span class="ruby-string">&quot;r&quot;</span>)
  <span class="ruby-identifier">target_data</span>.<span class="ruby-identifier">each_line</span> <span class="ruby-keyword">do</span>  <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">reviewer_val</span>, <span class="ruby-identifier">movie_val</span>, <span class="ruby-identifier">rating_val</span>, <span class="ruby-identifier">timestamp_val</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>
    <span class="ruby-identifier">userarray</span> = [{<span class="ruby-identifier">reviewer_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rating_val</span>}]
    <span class="ruby-identifier">moviearray</span> = [{<span class="ruby-identifier">movie_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rating_val</span>}]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@movie_hash</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">movie_val</span>) <span class="ruby-comment">#adding arrays to the hashes...</span>
      <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">movie_val</span>].<span class="ruby-identifier">push</span>({<span class="ruby-identifier">reviewer_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rating_val</span>})
    <span class="ruby-keyword">else</span> 
      <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">movie_val</span>] = <span class="ruby-identifier">userarray</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_hash</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">reviewer_val</span>)
      <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">reviewer_val</span>].<span class="ruby-identifier">push</span>({<span class="ruby-identifier">movie_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rating_val</span>})
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">reviewer_val</span>] = <span class="ruby-identifier">moviearray</span>
    <span class="ruby-keyword">end</span>
    
  <span class="ruby-keyword">end</span>   
  <span class="ruby-identifier">target_data</span>.<span class="ruby-identifier">close</span>   
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-most_similar" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">most_similar</span><span
            class="method-args">(user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Takes all the movies a user has seen and for each movie, finds all other
users who viewed it and rated it the SAME.  NOTE: because of the structure
of @user_hash and @movie_hash, the nested while loop causes this function
to operate on O(n) time, not n^2 time. This is bound by the data set, as
the method&#39;s number of checks cannot surpass the number of ratings
given in the movie data set.</p>
          
          

          
          <div class="method-source-code" id="most_similar-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">most_similar</span>(<span class="ruby-identifier">user_id</span>)   
  <span class="ruby-identifier">reviewer_similarity</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">user_movies_list</span> = <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">user_id</span>]
  <span class="ruby-identifier">user_movies_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span> <span class="ruby-comment">#nested while loop, operated in O(n) time.  </span>
    <span class="ruby-identifier">userlist</span> = <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]]
    <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">moviehash</span><span class="ruby-operator">|</span>
      <span class="ruby-comment">#If a user has seen this movie as well and rated it the same, he/she is added</span>
      <span class="ruby-comment"># to a hash which indicates how many times they have been added.</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">moviehash</span>[<span class="ruby-identifier">moviehash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]] <span class="ruby-operator">==</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">moviehash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>])
        <span class="ruby-identifier">user</span> =  <span class="ruby-identifier">moviehash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]
        <span class="ruby-comment">#hash uses user_id as key and maps them to a value corresponding to how many </span>
        <span class="ruby-comment">#times they have been found to be a &quot;good match&quot; for the user.</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">reviewer_similarity</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">user</span>) 
          <span class="ruby-identifier">reviewer_similarity</span>[<span class="ruby-identifier">user</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">reviewer_similarity</span>[<span class="ruby-identifier">user</span>] = <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">best_match</span>(<span class="ruby-identifier">reviewer_similarity</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-movielist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">movielist</span><span
            class="method-args">(user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of all the movies a user has seen by accessing the hash of
movie-rating pairs using the user as the key.</p>
          
          

          
          <div class="method-source-code" id="movielist-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">movielist</span>(<span class="ruby-identifier">user_id</span>)  
  <span class="ruby-identifier">moviearray</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">movie_list</span> = <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">user_id</span>]
  <span class="ruby-identifier">movie_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span> <span class="ruby-comment">#pushes each movie (key[0]) into the array</span>
    <span class="ruby-identifier">moviearray</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">moviearray</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-movies_average_modification" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">movies_average_modification</span><span
            class="method-args">(base_prediction, movie_id, user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Modifies the prediction based off of movie&#39;s average ratings</p>
          
          

          
          <div class="method-source-code" id="movies_average_modification-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">movies_average_modification</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  
<span class="ruby-identifier">modified_prediction</span> = <span class="ruby-identifier">base_prediction</span> 
<span class="ruby-identifier">popular_opinion</span> = <span class="ruby-identifier">rating_average</span>(<span class="ruby-identifier">movie_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">popular_opinion</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">3</span>
    <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">+=</span> <span class="ruby-value">0.2</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">popular_opinion</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">3</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>
    <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">-=</span> <span class="ruby-value">0.2</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">modified_prediction</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-predict" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">predict</span><span
            class="method-args">(predictive_users, movie_id, user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uses a collaborative filtering algorithm to create base prediction.  It
takes the average of the ratings of each of the users in the predictive
data group, and then uses it as the initial prediction.</p>
          
          

          
          <div class="method-source-code" id="predict-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">predict</span>(<span class="ruby-identifier">predictive_users</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  <span class="ruby-identifier">score</span> = <span class="ruby-value">0.0</span>
  <span class="ruby-identifier">total</span> = <span class="ruby-value">0.0</span>
  <span class="ruby-identifier">tally</span> = <span class="ruby-value">0.0</span>
  <span class="ruby-identifier">predictive_users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">score</span> = <span class="ruby-identifier">rating</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">movie_id</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-comment">#Takes the average score of users in the predictive </span>
    <span class="ruby-comment">#array and sets that to the prediction.  </span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">score</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">score</span>
      <span class="ruby-identifier">tally</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">base_prediction</span> = (<span class="ruby-identifier">total</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">tally</span>).<span class="ruby-identifier">to_f</span>
  <span class="ruby-identifier">prediction</span> = <span class="ruby-identifier">prediction_modifiers</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">prediction</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prediction_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prediction_data</span><span
            class="method-args">(user_id, movie_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Prediction_data  first checks if the user we are predicting is the same as
the previous, if it is, then the method uses the previously stored
predictive data. If it is not, the method gathers the list of best_matches
from “most_similar,” as well as the list of all viewers of the movie in
question. If no one else saw the movie, it will predict 1, and if no one is
a good match to predict off of, it predicts the movie average rating.
Otherwise it calls the predict method to use a basic collaborative
filtering algorithm as our initial prediction value.</p>
          
          

          
          <div class="method-source-code" id="prediction_data-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prediction_data</span>(<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">movie_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@user_marker</span>
    <span class="ruby-ivar">@best_match</span>.<span class="ruby-identifier">clear</span>
    <span class="ruby-identifier">most_similar</span>(<span class="ruby-identifier">user_id</span>) <span class="ruby-comment">#will return the top 20 best matched viewers.</span>
    <span class="ruby-ivar">@user_marker</span> = <span class="ruby-identifier">user_id</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">matched_movies</span> = <span class="ruby-identifier">viewers</span>(<span class="ruby-identifier">movie_id</span>) <span class="ruby-comment">#list of all users who saw the movie</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">matched_movies</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">prediction</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">prediction</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">predictive_users</span> = (<span class="ruby-ivar">@best_match</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">matched_movies</span>) <span class="ruby-comment">#sets our predictive data to be the subset </span>
                                                    <span class="ruby-comment"># of best_match that has also seen this movie</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">predictive_users</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">prediction</span> = <span class="ruby-identifier">rating_average</span>(<span class="ruby-identifier">movie_id</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">prediction</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">predict</span>(<span class="ruby-identifier">predictive_users</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prediction_modifiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prediction_modifiers</span><span
            class="method-args">(base_prediction, movie_id, user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Modifies the prediction based off of difference of our collaborative
filtering algorithm&#39;s guess and the movie&#39;s average rating, as well
as the user&#39;s average rating for any given movie. The actual modifying 
values (.2, .5) come from testing accuracy on the training set data</p>
          
          

          
          <div class="method-source-code" id="prediction_modifiers-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prediction_modifiers</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>) 
  <span class="ruby-identifier">modified_prediction</span> = <span class="ruby-identifier">movies_average_modification</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  <span class="ruby-identifier">modified_prediction</span> = <span class="ruby-identifier">users_pattern_rating</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">modified_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> <span class="ruby-comment">#checks if our modified result ended out of bounds (0 is min, 5 max)</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">5</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">modified_prediction</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rating" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rating</span><span
            class="method-args">(user_id, movie_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calculates rating by pulling up the rating of all the movies that a user
has seen, and if the user has seen the movie, returns the rating value.</p>
          
          

          
          <div class="method-source-code" id="rating-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rating</span>(<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">movie_id</span>) 
  <span class="ruby-identifier">movielist</span> = <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">user_id</span>]
  <span class="ruby-identifier">movielist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">movie_id</span>]
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">movie_id</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rating_average" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rating_average</span><span
            class="method-args">(movie_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Takes the array of user-rating pairings, converts the rating to an int, and
uses the sum of ratings / count of ratings to calculate its average rating.</p>
          
          

          
          <div class="method-source-code" id="rating_average-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rating_average</span>(<span class="ruby-identifier">movie_id</span>)  
  <span class="ruby-identifier">accumulator</span> = <span class="ruby-value">0.0</span>
  <span class="ruby-identifier">user_list</span> = <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">movie_id</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_list</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-comment">#If nobody saw the movie, return 0.</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">user_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">accumulator</span> <span class="ruby-operator">+=</span>  <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]].<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span>  <span class="ruby-identifier">average</span> = (<span class="ruby-identifier">accumulator</span> <span class="ruby-operator">/</span> <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">movie_id</span>].<span class="ruby-identifier">length</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_test" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_test</span><span
            class="method-args">(amount = 20000)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Runs tests using data from the training file (to create our predictive_user
array) and applies it to the data in the testing file.  Creates Class <a
href="MovieTest.html">MovieTest</a> which handles all of the error data for
our predictions. NOTE:  The test file is sorted by user, which is optimal
for this program.</p>
          
          

          
          <div class="method-source-code" id="run_test-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run_test</span>(<span class="ruby-identifier">amount</span> = <span class="ruby-value">20000</span>) <span class="ruby-comment">#if no amount specified, run all 20000 tests.  </span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@testfile</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-comment">#if originally no test file was specified, indicate and exit.</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;No data to test!&quot;</span>
    <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">results_array</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">target_data</span> = <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@testfile</span>, <span class="ruby-string">&quot;r&quot;</span>)
  <span class="ruby-identifier">target_data</span>.<span class="ruby-identifier">take</span>(<span class="ruby-identifier">amount</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-comment">#reading in specified amount of data to test.</span>
    <span class="ruby-identifier">reviewer_val</span>, <span class="ruby-identifier">movie_val</span>, <span class="ruby-identifier">rating_val</span>, <span class="ruby-identifier">timestamp_val</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>
    <span class="ruby-identifier">prediction</span> = <span class="ruby-identifier">prediction_data</span>(<span class="ruby-identifier">reviewer_val</span>, <span class="ruby-identifier">movie_val</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-comment">#calls prediction on user from the test_set.</span>
    <span class="ruby-identifier">results</span> = [<span class="ruby-identifier">reviewer_val</span>, <span class="ruby-identifier">movie_val</span>, <span class="ruby-identifier">rating_val</span>, <span class="ruby-identifier">prediction</span>]
    <span class="ruby-identifier">results_array</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">results</span>)
  <span class="ruby-keyword">end</span>  
  <span class="ruby-identifier">analyze_data</span>(<span class="ruby-identifier">results_array</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-users_pattern_rating" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">users_pattern_rating</span><span
            class="method-args">(base_prediction, modified_prediction, movie_id, user_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>modifying based off of user&#39;s own rating average.</p>
          
          

          
          <div class="method-source-code" id="users_pattern_rating-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">users_pattern_rating</span>(<span class="ruby-identifier">base_prediction</span>, <span class="ruby-identifier">modified_prediction</span>, <span class="ruby-identifier">movie_id</span>, <span class="ruby-identifier">user_id</span>)
  <span class="ruby-identifier">user_rating_avg</span> = <span class="ruby-value">0.0</span>  
  <span class="ruby-identifier">movies</span> = <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">user_id</span>]
  <span class="ruby-identifier">movies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">user_rating_avg</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]].<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">user_rating_avg</span> = <span class="ruby-identifier">user_rating_avg</span> <span class="ruby-operator">/</span> <span class="ruby-ivar">@user_hash</span>[<span class="ruby-identifier">user_id</span>].<span class="ruby-identifier">length</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_rating_avg</span>
    <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">-=</span> <span class="ruby-value">0.5</span> <span class="ruby-operator">*</span>(<span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">user_rating_avg</span>).<span class="ruby-identifier">abs</span> 
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">user_rating_avg</span>
    <span class="ruby-identifier">modified_prediction</span> <span class="ruby-operator">+=</span> <span class="ruby-value">0.5</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">base_prediction</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">user_rating_avg</span>).<span class="ruby-identifier">abs</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">modified_prediction</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-viewers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">viewers</span><span
            class="method-args">(movie_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of all the users who viewed a movie by accessing the hash
of user-rating pairs using the movie as the key</p>
          
          

          
          <div class="method-source-code" id="viewers-source">
            <pre><span class="ruby-comment"># File ml-100k/movies2_training.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">viewers</span>(<span class="ruby-identifier">movie_id</span>) 
  <span class="ruby-identifier">userarray</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">userlist</span> = <span class="ruby-ivar">@movie_hash</span>[<span class="ruby-identifier">movie_id</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">userlist</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span><span class="ruby-comment">#pushes each viewer (key[0]) into the array</span>
    <span class="ruby-identifier">userarray</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">userarray</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

